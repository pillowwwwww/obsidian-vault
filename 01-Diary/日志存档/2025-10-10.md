---
date: 2025-10-10 11:30:45
tags: dailynote
rating: ⭐
excerpt: 
---

## TODO
## Tracking

该框架评估aph的时候，为什么需要**快照恢复**而不只是**加载权重**？
- 你这里之所以用了“快照恢复”，是因为训练阶段只保存了“整台 server 的快照（包含每个客户端的模型）”，并没有把每个客户端的权重单独导出。要拿到每个客户端的个性化模型，只能先把快照恢复出来再抽取。

**什么时候用“快照恢复”**？

- 恢复训练现场：继续训练、精准复现一次训练中断时的“运行态”（全局模型、每个 client 的模型、副本、优化器、轮次、亲和矩阵等）。
- 审计/分析内部状态：需要看 FedFomo 的亲和矩阵 P、每轮参与名单、历史缓存等“非权重信息”。
- 没有单独保存客户端权重时：快照里“带着所有客户端的模型”，恢复一下就能统一拿到。

**什么时候用“加载权重（state_dict）”**

- 纯评估：只要“模型参数 + 数据”即可（比如 APH 的 Acc/NLL/ECE），不需要 server 的其它状态。
- 轻量、稳定、设备无关：恢复出的就是 CPU 张量，按需迁移到 GPU；不依赖训练时的代码环境，出错率低。
- 推荐做法：训练阶段“额外”把每个客户端模型另存为 client_{id}.pt（state_dict），评估时直接 initialize_model(config) → load_state_dict → rearrange_model → 评估，完全跳过快照。

**你现在为什么在这个位置需要快照**

- 你的产物是 best_snapshot.pkl，里面才包含“每个客户端的个性化模型”。想评 PFL 的 20 个客户端，就得先把 server 恢复出来再抽取它们。否则你手里没有各客户端的单独权重文件可用。