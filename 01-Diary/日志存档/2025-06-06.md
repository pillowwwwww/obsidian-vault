---
date: 2025-06-06 10:03:16
tags: dailynote
rating: ⭐
excerpt: 
---

## TODO

- [ ] 多喝水，避免久坐不动
- [ ] 阅读一篇文献

## Tracking
理解以FedAVG为例，理解ServerAvg，ClientAvg的实现逻辑与其交互


### 在服务器上跑实验！
1. **连接服务器**
	1.- `ssh liuchang@202.117.21.54 -p 22`
	`conda activate FL`
2. **在服务器上部署Miniconda**
3. **实验前准备**
	1. 配置文件：把模板中的配置文件（bench_cifar10_dir0.1_0）改一下：尤其是default_path，一定要改成自己的文件夹不要写别人的
	2. 实验结果：实验结果存放在mount/lc_data/experiment下面，以不同的算法命名
	3. experiment/FedAvg/Cifar10_NonIID_Dir0.1_Client20这是用到的数据集
	4. 20250530_161532_cnn_static_pr_1_ls_5_1_STAT_OPT_norm_clipping实验文件命名格式：时间+模型+静态+pr,1代表模拟攻击，0代表不攻击。
	5. nvidia-smi查询服务器上哪张卡空闲，配置文件中的device_id: '0'和1代表两张卡
4. **进入liuchang/code/MINI_FL/PFL/system**
	1. `nohup python main.py --config config/bench_cifar10_dir0.1_0.yaml >FedAvg.log 2>&1 &`
	2. `no hang up`，意为“不因挂断而停止”；给 `main.py` 传入了一个命令行参数 `--config`，告诉脚本从 `config/bench_cifar10_dir0.1_0.yaml` 文件里读取所有实验配置（包括数据集、模型、算法、超参数等）。
	3. `>FedAvg.log 2>&1`：这部分是 shell 的 **输出重定向** 语法，用来把程序的标准输出和标准错误都写到同一个文件里，避免在终端里看到大量日志。
	4. 命令末尾的 &：告诉 shell “把整个命令放到后台（background）执行”。后台运行的脚本不会占用当前终端的 stdin，也不会阻塞你的键盘输入。
	5. 执行这条命令后，shell 会打印一个后台作业号和对应的 PID
	6.  查看日志`cat FedAvg.log`（如果有未安装的包就pip install包名，然后重新nohup python）
5.  **怎么判断“实验跑完”了？**
    - **最直接的方法**：`tail -n 20 exp.log` 里最后应该出现类似：
        `Round number: 99 Evaluate global model Averaged Train Loss: ... Averaged Validation Accurancy: ... Averaged Test Accurancy: ... Std Test Accurancy: ... 所有独立实验完成，总耗时：... Average Test Accurancy over 3 runs: 0.xxx`
        如果你看到 “所有独立实验完成” 或“Average Test Accurancy over 3 runs” 这类总结性文字，就表明 3 次 × 100 轮的训练全部结束。
    - **也可以用**
        `ps aux | grep main.py`
        如果没有与 `main.py` 相关的进程在运行，就说明后台程序已经全部结束。
    只要满足上述任一条件，就可以确认“脚本真的跑完了”。
6.  接下来你可以使用record.h5进行可视化：
	1. 在本地：`PS E:\FL\Visualization> scp liuchang@202.117.21.54:/home/mount/lc_data/experiments/FedAvg/Cifar10_NonIID_Dir0.1_Client20/20250606_150807_cnn_static_pr_1_ls_5_att_0/Time_1/record/record.h5 .\Time1_record.h5`
 7. PS: 在python上改完代码要ctrL S!
 8. 关于服务器的信息：
	 1. 服务器上装有 **2 块 NVIDIA GeForce RTX 3090**。支持的 CUDA 版本为 **12.2**，安装的 NVIDIA 驱动版本为 **535.183.01**。



